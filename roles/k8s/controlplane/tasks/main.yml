---
- name: init k8s cluster
  become: yes
  ansible.builtin.shell: |
    kubeadm init --token {{ kubeadm_token }} \
      --apiserver-advertise-address {{ master_ip }} \
      --pod-network-cidr {{ pod_network_cidr }}

- name: make sure kuberenetes config dir is present
  ansible.builtin.file:
    path: ".kube/"
    state: directory

- name: copy admin.conf to home
  ansible.builtin.copy:
    src: /etc/kubernetes/admin.conf
    dest: ".kube/config"
    owner: vagrant
    group: vagrant
    mode: 0755
    remote_src: true
